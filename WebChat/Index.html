<!DOCTYPE html>
<html>
    <head>
        <title>Cirrus Chat</title>
        <style type="text/css">
            .container {
                background-color: #99CCFF;
                border: solid #808080;
                padding: 5px;
                /*margin: 5px;*/
                width: auto;
                height: auto;
            }
            /*.messages
            {
                width: inherit;
                height: inherit;
            }*/
            textarea {
                /* Try and go 100% while supporting padding and borders. */
                -webkit-box-sizing: border-box;
                -moz-box-sizing: border-box;
                -ms-box-sizing: border-box;
                box-sizing: border-box;

                /* Best to set all three of these or something will be 'inherit' and cause problems. */    
                font-size: 16px;
                line-height: 20px;
                font-family: helvetica;

                /* The reason for using border-box. */
                width: 100%;
                /*height: 60px; /* this doesn't help */
                /*padding: 10px;
                border: none;
                color: #999;*/

                resize: none;

                /*
                This is only here to show how it breaks. I probably wouldn't really be using a border in this kind of situation.
                */
                /*border: 10px solid #eee;*/
            }

            textarea:focus {
                outline: none;
                color: #333;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <span><textarea id="messages" rows="10" readonly></textarea></span>
            <span><input type="text" id="message" autofocus/></span>
            <span><input type="button" id="sendmessage" value="Send" /></span>
            <input type="hidden" id="displayname" />
        </div>
        <!--Script references. -->
        <!--Reference the jQuery library. -->
        <script src="/Scripts/jquery-1.8.2.min.js" ></script>
        <!--Reference the SignalR library. -->
        <script src="/Scripts/jquery.signalR-1.0.0.js"></script>
        <!--Reference the autogenerated SignalR hub script. -->
        <script src="/signalr/hubs"></script>
        <!--Add script to update the page and send messages.--> 
        <script type="text/javascript">
            $(function () {
                // Declare a proxy to reference the hub. 
                var chat = $.connection.chatHub;
                // Create a function that the hub can call to broadcast messages.
                chat.client.broadcastMessage = function (name, message) {
                    // Html encode display name and message. 
                    var encodedName = $('<div />').text(name).html();
                    var encodedMsg = $('<div />').text(message).html();
                    // Add the message to the page. 
                    $('#messages').append(encodedName + ": " + encodedMsg + '\n');
                    console.log('Top:' + $('#messages').scrollTop);
                    console.log('Height:' + $('#messages')[0].scrollHeight);
                    $('#messages').scrollTop($('#messages')[0].scrollHeight);
                };

                //$('#messages').scrollTop = 99999;

                // Get the user name and store it to prepend to messages.
                $('#displayname').val(prompt('Enter your name:', ''));
                //// Set initial focus to message input box.  
                //$('#message').focus();
                // Start the connection.
                $.connection.hub.start().done(function () {
                    $('#sendmessage').click(function () {
                        // Call the Send method on the hub. 
                        chat.server.send($('#displayname').val(), $('#message').val());
                        // Clear text box and reset focus for next comment. 
                        $('#message').val('').focus();
                    });
                });

                $('#message').live("keypress", function (e) {
                    if (e.keyCode == 13) {
                        $('#sendmessage').click();
                    }
                });
            });
        </script>
    </body>
</html>